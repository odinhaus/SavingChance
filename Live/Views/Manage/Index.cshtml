@model Live.Models.IndexViewModel
@{
    ViewBag.Title = "Manage";
}

@Html.Partial("_LoginPartial")

<div class="content-center">
    <section id="registerForm">
        <h2>Account Settings</h2>
        <hr />
        <div>
            @if (Request.IsAuthenticated)
            {
                using (Html.BeginForm("LogOff", "Account", FormMethod.Post, new { id = "logoutForm", @class = "navbar-right" }))
                {
                    @Html.AntiForgeryToken()
                    <div><a href="javascript:document.getElementById('logoutForm').submit()">Log Off</a></div><br/>
                }
                <dl class="settings">
                    <dt>
                        @if (Model.User.UserType == Live.Models.UserType.Donor)
                        {
                            ViewBag.AccountMessage = "The Donor account type allows you to follow, share, and donate to existing Saving Chances.  "
                                                   + "If you represent a 501c3 organization, and would like to be able to create Saving Chances and "
                                                   + "accept crowd funding, "
                                                   + "<a href=\"mailto:accounts@savingchance.com?subject=Register My 501c3 - Account-Ref: "
                                                   + Model.User.Id + " - " + Model.User.Email + "&body=I'd like to upgrade my account to 501c3 status.  What do I need to do?\">"
                                                   + "contact us</a>, and we'll get you started.";
                        }
                        else
                        {
                            ViewBag.AccountMessage = "The Provider account type allows you follow, share and donate to existing Saving Chances, as well as creating your own Saving Chances, and accepting payments through them.";
                        }
                        
                        Account Type <i data-toggle="popover" data-html="true" data-placement="right" title="Account Type" data-content="@ViewBag.AccountMessage" class="fa fa-question-circle help-icon"></i>
                    </dt>
                    <dd>
                        @Model.User.UserType
                    </dd>
                </dl>
                if (Model.User.UserType == Live.Models.UserType.Provider)
                {
                    <div>

                        @if (string.IsNullOrEmpty(Model.User.StripeAccountId))
                        {
                            <p class="payment-errors" style="text-align: left">You need to authorize a valid Stripe.com account 
                            by <a href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id=@System.Configuration.ConfigurationManager.AppSettings["StripeClientId"]&scope=read_write">following this link</a>, 
                            and granting permission for SavingChance.com to process payments on your behalf.</p>
                            <p>You will not be able to create Save Chances and accept payments until you complete this step.</p>
                        }
                        else
                        {
                            <p>Your account is currently registered to accept payments through your Stripe.com account.</p>
                            <p>You can remove the association to your Stripe.com account by <a href="/Manage/RemoveStripe">following this link</a>.</p>
                            <p><strong>Note</strong>, this will disable all of your current Save Chances, 
                            and prevent you from creating new Save Chances and accepting payments.</p>
                        }

                    </div>
                }
            }

            <br/>
            <h4>Security Settings</h4>
            <p class="text-success">@ViewBag.StatusMessage</p>
            <hr />
            <ul>
                <li class="no-bullet">
                    @if (Model.HasPassword)
                    {
                        @Html.ActionLink("Change Password", "ChangePassword")
                    }
                    else
                    {
                        @Html.ActionLink("Create Password", "SetPassword")
                    }
                </li>
                <li class="no-bullet">
                    @Html.ActionLink("Manage Logins", "ManageLogins") 
                </li>
            </ul>
        </div>
    </section>
</div>